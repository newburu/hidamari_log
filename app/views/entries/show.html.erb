<%# app/views/entries/show.html.erb %>
<h1><%= @date.strftime('%Y年%m月%d日') %> の記録</h1>

<div data-controller="clipboard">
  <div class="row mt-4">
    <%# --- Good & New の表示 --- %>
    <% if @event %>
      <div class="col-md-6">
        <div class="card">
          <div class="card-header d-flex justify-content-between align-items-center">
            Good & New
            <%= link_to '編集', edit_event_path(@event), class: 'btn btn-secondary btn-sm' %>
          </div>
          <div class="card-body">
            <div class="card-text" data-clipboard-target="source"><%= simple_format(@event.content) %></div>
          </div>
        </div>
      </div>
    <% end %>

    <%# --- 目標の表示 --- %>
    <% if @goal %>
      <div class="col-md-6">
        <div class="card">
          <div class="card-header d-flex justify-content-between align-items-center">
            目標
            <%= link_to '編集', edit_goal_path(@goal), class: 'btn btn-secondary btn-sm' %>
          </div>
          <div class="card-body">
            <p class="card-text"><%= @goal.title %></p>
          </div>
        </div>
      </div>
    <% end %>
  </div>

  <div class="mt-4 d-flex align-items-center">
    <%= link_to "カレンダーに戻る", root_path, class: "btn btn-outline-secondary" %>
    <% if @event %>
      <button data-action="click->clipboard#copy" class="btn btn-outline-secondary ms-2">
        <i class="bi bi-clipboard"></i> 内容をコピー
      </button>
      <%
        # 詳細ページのURLを取得
        page_url = entry_url(@event.start_time.to_date)

        # ツイートの本文を作成（URLと、その後の改行も本文に含める）
        tweet_text = "今日のGood & New！\n\n#{@event.content}\n\n#{page_url}\n\n"

        # ハッシュタグ
        hashtags = "ひだまりろぐ"

        # Twitter Intent URLを作成（url= パラメータを削除）
        tweet_url = "https://twitter.com/intent/tweet?text=#{u(tweet_text)}&hashtags=#{u(hashtags)}"
      %>
      <%= link_to tweet_url, class: "btn btn-info ms-2", target: "_blank" do %>
        <i class="bi bi-twitter-x"></i> Xでシェア
      <% end %>
    <% end %>
  </div>
</div>