<% if current_user %>
  <%# --- ログインしているユーザー向けの表示 --- %>
  <h1 class="brand-logo"><%= t('app.name') %></h1>

  <%= month_calendar(
        events: @calendar_items,
        table: { class: "table table-bordered" },
        day_class: ->(date) {
          classes = []
          classes << "saturday" if date.saturday?
          classes << "sunday" if date.sunday?
          classes.join(' ')
        }
      ) do |date, items_on_day| %>
    <% if items_on_day.present? %>
      <%# 記録があれば、その日の詳細ページへ %>
      <%= link_to date.day, entry_path(date) %>
    <% else %>
      <%# 記録がなければ、新規登録ページへ %>
      <%= link_to date.day, new_entry_path(start_time: date) %>
    <% end %>
    <br>
    <%# この日のアイテムを一覧表示 %>
    <% @calendar_items.map(&:start_time).uniq.each do |day| %>
      <% if day == date %>
          <%= link_to "詳細を見る", entry_path(day.to_date), class: "day-link" %>
        <% break %>
      <% end %>
    <% end %>
  <% end %>

<% else %>
  <%# --- ログインしていないユーザー向けの表示 --- %>
  <div class="p-5 mb-4 bg-light rounded-3 text-center">
    <div class="container-fluid py-5">
      <h1 class="display-5 fw-bold">「<%= t('app.name') %>」へようこそ</h1>
      <p class="fs-4">日々の「よかったこと」や目標を記録して、毎日を少し豊かにしませんか？</p>
      <p>まずはログインして、あなただけのカレンダーを始めましょう。</p>
      <div class="d-grid gap-2 d-sm-flex justify-content-sm-center mt-4">
        <%= button_to "Googleでログイン", "/auth/google_oauth2", class: 'btn btn-outline-primary', form: { data: { turbo: false } } %>
        <%= button_to "Xでログイン", "/auth/twitter2", class: 'btn btn-outline-info', form: { data: { turbo: false } } %>
      </div>
      <p class="mt-4">お試し利用はこちら。</p>
      <%= button_to "ゲストログイン", guest_login_path, method: :post, class: 'btn btn-outline-secondary' %>
    </div>
  </div>

  <%# app/views/calendar/index.html.erb の更新履歴セクション %>
  <hr class="my-5">

  <div class="row justify-content-center">
    <div class="col-lg-8">
      <h2 class="h4 text-center mb-4">✨ 最近のアップデート</h2>

      <%# ループ処理で更新履歴を一つずつ表示する %>
      <% @latest_changelogs.each do |log| %>
        <div class="card mb-3">
          <div class="card-header fw-bold">
            <%= log.published_on.strftime('%Y年%m月%d日') %>
          </div>
          <div class="card-body">
            <p class="card-text">
              <%= raw log.content %>
            </p>
          </div>
        </div>
      <% end %>

      <%# 「もっと見る」ボタンはループの外に一つだけ表示 %>
      <div class="text-end mt-2">
        <%= link_to "もっと見る →", changelog_path %>
      </div>
    </div>
  </div>

<% end %>